<!DOCTYPE html>
<html>
<head>
    <title>Motor Status Dashboard</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial;
            text-align: center;
            padding-top: 100px;
            background-color: #f2f2f2;
        }

        h1 {
            font-size: 2.5em;
        }

        .status {
            font-size: 2em;
            margin-top: 30px;
        }

        .green { color: green; }
        .yellow { color: goldenrod; }
        .red { color: red; }
        .black { color: black; }
    </style>
</head>
<body>
    <h1>Motor State: <span id="state" class="black">Waiting for data...</span></h1>
    <div class="status">Confidence: <span id="confidence">-</span></div>

    <!-- Audio alert -->
    <audio id="alert-sound" src="{{ url_for('static', filename='alert.mp3') }}"></audio>

    <script>
        const socket = io();
        const stateSpan = document.getElementById('state');
        const confidenceSpan = document.getElementById('confidence');
        const alertSound = document.getElementById('alert-sound');

        let lastState = '';

        socket.on('update', function(data) {
            const state = data.state;

            // Update only if state has changed
            if (state !== lastState) {
                // Play alert if critical state
                if (state === 'abnormaal' || state === 'uit') {
                    alertSound.play().catch(() => {
                        console.log("⚠️ Unable to play sound automatically.");
                    });
                }

                lastState = state;
            }

            // Remove old colors
            stateSpan.classList.remove('green', 'yellow', 'red', 'black');

            // Update text and color
            stateSpan.innerText = state;
            confidenceSpan.innerText = data.confidence;

            if (state === 'normaal') {
                stateSpan.classList.add('green');
            } else if (state === 'abnormaal') {
                stateSpan.classList.add('yellow');
            } else if (state === 'uit') {
                stateSpan.classList.add('red');
            } else {
                stateSpan.classList.add('black');
            }
        });
    </script>
</body>
</html>
